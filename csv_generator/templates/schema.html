{% extends "schema_base.html" %}

{% block title %} Schemas {% endblock %}

{% block content %}
<div class="container">
    <div class="columns">
        <div class="column">
            <form class="" method="POST" action="">

                <div class="columns">
                    <div class="column">
                        <p>{% if schema %}{{ schema.name }}{% else %}New schema{% endif %}</p>
                    </div>
                    <div class="column">
                        <div class="field is-grouped is-grouped-right">
                            <p class="control">
                                <button type="submit" class="button is-link">Submit</button>
                            </p>
                        </div>
                    </div>
                </div>

                {% csrf_token %}
                <div class="columns">
                    <div class="column is-half">
                        <div class="field">
                            <label class="label">{{ form.name.label }}</label>
                            <div class="control">
                                {{ form.name }}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="columns">
                    <div class="column">
                        <p>Schema columns</p>

                        {{ formset.management_form }}
                        {% for col in formset %}
                        <div class="field is-horizontal schema_column">
                          <div class="field-body">
                            <div class="field">
                                <label class="label">{{ col.order.label }}</label>
                              <p class="control is-expanded">
                                {{ col.order }}
                              </p>
                            </div>
                            <div class="field">
                                <label class="label">{{ col.name.label }}</label>
                              <p class="control is-expanded">
                                {{ col.name }}
                              </p>
                            </div>
                            <div class="field">
                                <label class="label">{{ col.data_type.label }}</label>
                              <p class="control is-expanded">
                                {{ col.data_type }}
                              </p>
                            </div>
                          </div>
                        </div>
                        {% endfor %}

                        <input type="button" value="Add column" id="add_column" class="button is-info">
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock content %}

{% block javascripts %}
<script>
    function cloneColumn(selector, type) {
        var newColumn = $(selector).clone(true);
        newColumn.find(':input').each(function() {
            $(this).val('');
        });
        $(selector).after(newColumn);
    }

    $('#add_column').click(function() {
        cloneColumn('div.schema_column:last');
    });
</script>
{% endblock javascripts %}